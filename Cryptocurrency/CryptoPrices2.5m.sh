#!/bin/bash

# <bitbar.title>Crypto Prices</bitbar.title>
# <bitbar.version>v1.1</bitbar.version>
# <bitbar.author>FL</bitbar.author>
# <bitbar.author.github>monerohow</bitbar.author.github>
# <bitbar.desc>Shows the last XMR, XRP, BTC, LTC and ETH prices (in USD) on different exchanges</bitbar.desc>
#
# Based on Kraken Monero plugin https://github.com/matryer/bitbar-plugins/blob/master/Cryptocurrency/Monero/monero-usd-kraken.30s.sh

moneroIconBase64='iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACtElEQVR4nE2Tz2udRRSGn3Nm7v2aLzeWFouBtCm6cFFwIXRTRVOjNbfEH0TIP9CKdtMWWlxYqNeqkC4KCt1o/dLiOiC6kbTYhWYT8C9Qd4VWBKNok/vd3Myc4+K7LZnVC3Oed87Me0YAHETAAfqneTEG3lNhRpwpABceGPycMjfKirXdjDwSv3Upnp7mmipnNBDJgNEsBQJYJpvz9R9/c2F6hdpBxBcJv08Sn9nmhzDGLH0cwUaYjCwcMBylRHLN2oN/mDsEQ5UV8uEtPg8Fs9SA4M15j2FGOiA4NYSClyaf4LqskGXrFEfLkl/ygJ+Ss1qMs8SAtNvEG5HYQ6z7XI7wcqvkRL3JC9oSzhJxhPaeZa4O+3xCQQTyiG3ggpj6LJUVn7nTJuBROaciHCc3LXoPLSp6g1o+3WWSKIiDWq62Ki55D1UhkBCBGVVh8tFryxXMFwljlX80rKXppIGXxir/0BcJcmVUbRCFA1EFw0nZBXDe2Hz91Dtzdq+ofuxtnZaOCLGs/NLCyVdm39xsPwu3v0wuRPeEYJqMLcaJLuxvMg9TXk58+1b31efHl/1iWfn5t0++9pwXe78X9PAolX2ME7MziMn5wGqO1EnugwvGwxBCmVrl7YX5E7M56Y7F9p0ixs5wOPgXkNrlK6192oxf49gyt5q0mqtld0kpuYgcGNK+S8SCyGRKya0p8f037XrDOOKLhIXNufPSLs5s76S/ROSQqh40M1NVFRFyzqaqmnO+D9wrWvFJS4Pl78o71/TjIz1/OEzf7GT7b2Ji4lgI4aCZZRERd3czMxERM8shhKlOp3NsJ1t/O+tNWcFlNG3e7XaLEMIXIYR3VTXmnHH3Jl4RQgjknLOZ3drY2Di3vr5e03zEx7PuAPPz88dF5H1gBnhqtP8nsJZSurG6unp3N/M/llI6HEcL354AAAAASUVORK5CYII='
xrpIconBase64='iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAACvklEQVQ4EX1TzUtVQRQ/Z+59XyoamiUaRAuD3NiiRUKEhtsQNDQsCFciQfUf9MiVq9Ii2lTUokwpECKipJIEo0UbW1X0oVQ+9OV7+t79nnM6c5UM+jhwL2fm/OY3M7/zG4T/RTarIJslyD6vSmnvIvnuCQ4D5EhPaYVnYbQ/h/9ez1JDNvXUhSf3IZHp5vx3oDBiTlQglApzumH34S2CLCuAF/KZmCFoaUHo7dWZkdmD7Dtz5DrEUQgcyheExGjZFARH7Rg/wRb0opac4rH5jb1PyV8j6B1sGRiD7KY4PpPgTEJhky13VGZx3cRiUxD4nRj4mkP78fpg84rhIQXzoMNltBL1FEWBYZFIAst+KvkmHm57sNTFjnNdWOs4ioCc0qJW1jF3aP9rg84MT18hwNNcXhcIAkUaJB+la6fOYe2j/C5eL79lUDW09iPiMAKwU7aQLMuxO8sZ+0M6l3/IBB3klp9BpD+Tpml9qe+uIbfRC45wMl3DxXwIStmgENgrCQvXi1hzGdcpcKqqEcvFe+FI93GzaCsYleZNWczshkBbdYQ1mTPimtpmh7bKJsPtU8uNkefOA1q1VMxHRgPpuU3rxUVKp9vSKio5SyszQNhKnjMLYbggYk7rsf6bhkCtdNV/Q5U4yYGXw1SFjamMDb77iZOpHhHx6+rggSKCegeWBYh4COxkPyTSN9TQ7avxCeI2il0r73zcaUXUIeyRsEwXBvYUDCA5MrcPvbVXEPjV5PuhmIk5CJJxN4DajA8IxEjlXswJftwsisMY6Uyzb3O4l6xENZFDiJCIFUOUe4rgvte64UTjwt+tfL5dw+SkgEQ7BHkAJkXzMMQOZtJUjC/thQ1fmfGf8QuaHn46zna6j/NL4l65QvyYVl/qhi/tf23NJhfH+sjAq6wcALd0mS2rJF7xIHBu6QT3mOv/BB5FetBXemtFAAAAAElFTkSuQmCC'
btcIconBase64='iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAWtJREFUOBGtk0srRlEUho9bFDJBTImklAmSzPwDBkZ+gGKGMvcjTI3lT5CJUhiY8WEil1yiyPV5zjnr+86Hobees9Zee6+1917tkyT/qBpqNeX15rG70AaHMAuqITOVb23umvwFL/nYxGF4gCGIwm/4dVCWA4uY3AfrMAlT0A1j0A+t0AxXcA+Rg1upOIJ/DRaTD3gCkyL2ij8BquokxcAyAxPOoR3ceQbuwPgWqHo/0QN9+6AeM5O8Y2/gGTbhElTVzmmVLF7+RqfdObo/jT8AFlsF5WmqFMUWiDppx7VF7Mka/KmfBS5Y1QNdMA7bEMXm8FV9JDmIHnh3pS3BJ3j/RdgHNZiZpKZYwIXKuysbrO9VOmEJQse544nKO3fglyCO6Qmu4awQc24HotHpCeIZtzBxCgdgx3vhBEbhCEzcgw3wkUUe7m+tELoFF3mFaBpuKuOpig/JQGMWTn8eF/lTaaMvTfk4vTt+8g2AMVLdYjT7kAAAAABJRU5ErkJggg=='
ltcIconBase64='iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAVZJREFUOBF9kjsvBlEQhtclEpEoEAWNRiMREVQaGrV/oBCJXuIvUej0/AKFBIWEoCZK98vz7M5sju+Tb5Jn35k5Z2bPmd2q+msDES6jP/Aeuhn5wdBW+luvcfoiXgo1/oTzIs49daqzQeyrVsLxjbdwD/of4MnautYhqX01Ui2GKpfwDZ5kHXYjrmvLBh7N7pMwG5uQ6tQHtg8nkHMqa11vF9bwbZTH3cE/jtwjOgVaV4Oc8B6LNvDIr+EbH8E4aF3FJod8YAdgQRarW5CWV8i41rLjNRkbiJ9vGjQLy3110kd+11H8Q7DwLXQb1YYb6f28YNlih+fn1F8Fzfn4ohLzrS3gvcAVWChOfAR6Wt7J+/m2s2L3TfgTqNNPxvDNtdfKJuSqB/Dt/nlO/wmeO/BkXnMDassGc0QWZoO8yn/qvhmoP0s2mCd2SHbX3OQwS801Z3UH1S+dUlfot4cjAgAAAABJRU5ErkJggg=='
ethIconBase64='iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAActpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+QWRvYmUgSW1hZ2VSZWFkeTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KKS7NPQAAAXRJREFUOBF9kksrhUEYgI9bSUhKRMm9XEo2LiliKQt/wI4slWxk6V9Y8wvsFdkoRZGdOr+AJMn1eJ5p5pzzHSdvPb0z817nncnlqkttPJ5Cz8d1XTXX5Fhp+4kHy+hdqIHvqFElqZYgnc3g1gIjsBlD/nSRnKM9VLJ6G8zCJ7zABvTAF2RiMhuMtqosQRMUwCAT7oCSfMKmPIFrqw/DKDyDCWz7EVZgEZxF8SrlCdLgbN2q/bAAtt4MXmcblOJAUyYTWc0qqzAGE+AQ26EVtA+BMRdRF1IHGpVuMHAQ3uADrGb13rhuQCuh49RBGswThmvwCuNQD53gQI8i2vMQYioTvGOYhhs4hwHwGQ/AinNwCPqFBKky+/C+OnXBFuThAXyVNZgEZ3QPFvZqpedg7RyciRVfwU76YB38jXtwCl4rBKOzv4q9HdjVFdzFtQEncAwWcD7/SrpWI177cAYdMcIEGUlDzByy8dyn8xkv4RYyrbMP8gsDB0bv6oHZDQAAAABJRU5ErkJggg=='
xlmIconBase64='iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAACMUlEQVQ4EWNgIABWrVrFTEAJbun///8zQmVZXINjTapa+w1wq0aTgWmesGB58r5Lty5ffPbm/7aT5+4DlfFAlcIMR9XZ0NDA1DB/PgdIdNqKdaWnHzz9f/ja3f/3v/75f/Lu459A/ZogOZA6EM0CImAArLmh4R+Q/8PVzlVVUU29meX7VwZ9SZE/p65dZuEREABKqf9nYDgL04JCg53UOW2uunNgdPbctVuOPvjx///hsxf/XL124++Ze4//77lw9SZQBztUF1g92BlQ5/wvaeqOufvg4QV5OZkp+iZGVsyMDP/4ZeSZv3DxM3Lx8TMc2r+/Baj5JzRmgC5BAiDB2r5p9rpWLv5zth+6+fzf//+33n/7++Db3z+Pfvz9P2XJ6maQcmDggi1F0orJPD6nevuRa7f+3/3xH2jAn/+dMxf9ZmCQMwaphAUeTBfctP/QUP1UG2hpwNvqIHVTjeHhkZ1/9+zZ/+L40aMs+Q3p2iBNV7W0UKIPbgADwwEwm1XouRIHgxaH3G+1p9rrPBxS/NIMZKQl7zEz/L8DMkD72jUUv8MMYGRsOPAH6EHG7zr2W348Yk/5ckrdVnwawzEGhvsvBXh5c/kY/lwAGQD0AiiaUQDYSdu2bWPfvHmzV9+qY5ww2VWrGIAWw5MzTBiFBrkA7KSfP386MTExsRZe2/VzfwMDCyhMwsIY/jIwMgKZkFSHohPKgdnO9+vXLxlVVdU72trav4ByIHEUv2LTTBUxAIXD53WnWBnGAAAAAElFTkSuQmCC'

xmrLast=$(curl -s "https://api.kraken.com/0/public/Ticker?pair=xmrusd" | tr -d '{}"[]' | tr ':,' '\n' | grep -A1 "^c$" | tail -1)
xrpLast=$(curl -s "https://api.kraken.com/0/public/Ticker?pair=xrpusd" | tr -d '{}"[]' | tr ':,' '\n' | grep -A1 "^c$" | tail -1)
btcLast=$(curl -s "https://api.coinbase.com/v2/prices/BTC-USD/spot" -H "CB-VERSION: 2017-04-16" | egrep -o '"amount":"[0-9]+(\.)?' | sed 's/"amount"://'  | sed 's:^.\(.*\).$:\1:')
ltcLast=$(curl -s "https://api.coinbase.com/v2/prices/LTC-USD/spot" -H "CB-VERSION: 2017-04-16" | egrep -o '"amount":"[0-9]+(\.)?' | sed 's/"amount"://'  | sed 's:^.\(.*\).$:\1:')
ethLast=$(curl -s "https://api.coinbase.com/v2/prices/ETH-USD/spot" -H "CB-VERSION: 2017-04-16" | egrep -o '"amount":"[0-9]+(\.)?' | sed 's/"amount"://'  | sed 's:^.\(.*\).$:\1:')
xlmLast=$(curl -s "https://api.coinmarketcap.com/v1/ticker/stellar/" | fgrep price_btc | sed 's/.*": "//' | sed 's/",//')

printf "$%.*f | image=%s\n" 2 "$xmrLast" "$moneroIconBase64"
printf "$%.*f | image=%s\n" 4 "$xrpLast" "$xrpIconBase64"
printf "$%.*f | image=%s\n" 0 "$btcLast" "$btcIconBase64"
printf "$%.*f | image=%s\n" 0 "$ltcLast" "$ltcIconBase64"
printf "$%.*f | image=%s\n" 0 "$ethLast" "$ethIconBase64"
echo ---
# Lines below don't auto-cycle in the menu bar
printf "$%s | image=%s\n" "$xlmLast" "$xlmIconBase64"
